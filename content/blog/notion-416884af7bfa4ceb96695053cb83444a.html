---
title: Self signed SSL certificates on iOS
tags:
  - devops
  - today-i-learned
  - https
date: '2024-01-18T23:51:14.133Z'
slug: self-signed-ssl-certificates-on-ios
draft: false
---

<article id="416884af-7bfa-4ceb-9669-5053cb83444a" class="page sans"><div class="page-body"><p id="bdf519f5-066e-4206-b714-3f83d305fd87" class="">Recently I was working on a project and I needed to add an SSL certificate for the API service. Normally you would use <a href="https://letsencrypt.org/">Let‚Äôs Encrypt</a> or some other certificate authority after deploying the service. In this case, though, my service will always only run on a local network and thus I have to generate a self-signed certificate.</p><p id="4cad7900-3e3b-4a15-afd7-f93c85b50635" class="">I already <a href="https://jozefcipa.com/blog/running-https-on-localhost/">wrote a post</a> about generating custom SSL certificates in the past. However, since then I came across a way better and nicer solution called <strong>mkcert </strong>(<a href="https://github.com/FiloSottile/mkcert">Github repo</a>). If you don‚Äôt know this tool, I recommend taking a look if you ever need to generate the SSL certificates locally. </p><p id="f4928af8-a3b2-409c-8c5e-d140ed7fe0c0" class="">The whole process is very easy and seamless and you soon end up with generated certificates that you can add to your application or a web server such as NGINX or similar.</p><p id="1394a305-5661-47fa-b8aa-4eb454aeaf26" class="">But, what happens if you open a website with such a certificate on your mobile device (assuming it‚Äôs on the same network as the API obviously)?</p><p id="eb7b2aa2-44b6-4182-96b9-4bda6c4c4286" class="">Let‚Äôs say our application is exposed at the IP address 192.168.0.199. Opening that in the browser would give us the following screen.</p><p id="1998ae44-2b73-418f-85a2-0dd7e96a8bc8" class="">
</p><figure id="142fee8c-b779-4782-99c7-7447fea51071" class="image"><a href="https://assets.jozefcipa.com/blog/416884af7bfa4ceb96695053cb83444a/safari-insecure.png"><img style="width:240px" src="https://assets.jozefcipa.com/blog/416884af7bfa4ceb96695053cb83444a/safari-insecure.png"></a></figure><p id="aca87d96-c7e3-40fc-91a6-34b0b4544427" class="">
</p><p id="934a5521-e6f2-46b8-8ab5-6a79873ff54f" class="">Yikes, how‚Äôs that possible you ask? We do have the SSL certificate set up after all.</p><p id="23a501c5-e0eb-4b75-abc0-2420700357a2" class="">Well, that‚Äôs because even though we have indeed added the certificate, it‚Äôs not recognized by the browser as it has not been signed by a trusted <a href="https://www.ssl.com/article/what-is-a-certificate-authority-ca">certificate authority</a> (CA). CA verifies the authenticity of the website and ensures it‚Äôs legitimate and secure. Without a trusted CA, browsers may display warnings or block access to websites with self-signed or unverified SSL certificates. And that‚Äôs exactly what happened here.</p><p id="9cf1fae9-5ac2-43da-8085-8eaaf220d898" class="">Therefore we need to make sure the iPhone recognizes our custom certificate authority. </p><p id="474689d3-35cb-46cd-bb43-3f2cbe42c1b4" class="">
</p><blockquote id="75302bc8-d15e-4ee3-a3d5-5c410e2dc27c" class=""><em>mkcert automatically creates and installs a local CA in the system root store, and generates locally-trusted certificates</em></blockquote><p id="056d9a33-6166-4639-adeb-b7354d99e26a" class="">
</p><p id="4a3214de-003e-4e09-9e2d-6d17409089a4" class="">mkcert comes in handy and we can find the local CA by calling </p><p id="d6e08f20-8ddc-4545-8ab7-2202f54c3956" class=""> <code>$ mkcert -CAROOT</code></p><p id="cac1c223-b7ce-46fd-809f-8bc06bf932a3" class="">This will return a path to the root certificate, which might look like this</p><p id="69ab6f13-6d19-4176-b061-0514675e4602" class=""><code>/Users/jozefcipa/Library/Application Support/mkcert</code></p><p id="5556a755-c7c4-4a1a-b58a-ee0c6589d243" class="">If you open this path you will find a file called <code>rootCA.pem</code></p><p id="2a7724e8-12c0-48d4-8f11-22900cb4d3f0" class="">This is the CA certificate that we need to register on our iPhone. We can send the file over to the iPhone using Airdrop.</p><p id="24120444-7c66-4896-94b1-dd957d8c2049" class="">After we accept the file, let‚Äôs open Settings and tap on ‚ÄúProfile Downloaded‚Äù and then ‚ÄúInstall‚Äù.</p><div id="7105f35e-642c-4de2-a9a6-caaec4665e83" class="column-list"><div id="bd3bc5a6-30aa-4dd9-9658-d68a4091b760" style="width:33.33333333333333%" class="column"><figure id="65061c1c-1da3-41d3-a6b2-773d3bd5cc60" class="image"><a href="https://assets.jozefcipa.com/blog/416884af7bfa4ceb96695053cb83444a/profile-downloaded.png"><img style="width:240px" src="https://assets.jozefcipa.com/blog/416884af7bfa4ceb96695053cb83444a/profile-downloaded.png"></a></figure></div><div id="d6792ffe-42ac-4082-91f5-89688d40d0e4" style="width:33.33333333333333%" class="column"><figure id="a3fa73c7-ad85-4840-b10f-4f0671a0f8b5" class="image"><a href="https://assets.jozefcipa.com/blog/416884af7bfa4ceb96695053cb83444a/settings.png"><img style="width:240px" src="https://assets.jozefcipa.com/blog/416884af7bfa4ceb96695053cb83444a/settings.png"></a></figure></div><div id="634a386c-42e1-4fc3-b1f7-db4b134fc247" style="width:33.33333333333333%" class="column"><figure id="1e6bd6e0-1f7b-4197-90c1-2e05519d114d" class="image"><a href="https://assets.jozefcipa.com/blog/416884af7bfa4ceb96695053cb83444a/profile-install.png"><img style="width:240px" src="https://assets.jozefcipa.com/blog/416884af7bfa4ceb96695053cb83444a/profile-install.png"></a></figure></div></div><p id="befc57a3-60ef-49c4-9c5c-09e14eb4c55b" class="">
</p><p id="425864d1-0d81-4a21-892d-3f26fe1960d3" class="">Now that we have installed the certificate, we have to enable <strong>Full Trust</strong>. </p><p id="781b3773-5fac-4d90-8825-d508d5593222" class="">Let‚Äôs go to Settings ‚Üí General ‚Üí About ‚Üí Certificate Trust Settings and switch the toggle on.</p><p id="e5ed5c25-db62-4004-a62f-7d1af144f2c3" class="">
</p><figure id="5b9ce102-2d5e-4236-afa8-f3a325b0f640" class="image"><a href="https://assets.jozefcipa.com/blog/416884af7bfa4ceb96695053cb83444a/cert-trust.png"><img style="width:240px" src="https://assets.jozefcipa.com/blog/416884af7bfa4ceb96695053cb83444a/cert-trust.png"></a></figure><p id="1999866c-b8c3-4383-a582-aa13b674db2e" class="">
</p><p id="1862ff26-4534-4b14-aa3a-5ce4c806e528" class="">Now the iPhone will start accepting our generated self-signed SSL certificates as it knows the root Certificate Authority that signed these certificates.</p><p id="85bc63e0-5537-4440-a6fd-1cb2976401d7" class="">Refreshing the website again will give us the website and we can also notice the little lock symbol in the search bar üéâ.</p><p id="05251620-633d-4af9-a015-c9a10c96c58c" class="">
</p><figure id="077e88d2-9176-4645-be22-d62935611190" class="image"><a href="https://assets.jozefcipa.com/blog/416884af7bfa4ceb96695053cb83444a/safari-working.png"><img style="width:240px" src="https://assets.jozefcipa.com/blog/416884af7bfa4ceb96695053cb83444a/safari-working.png"></a></figure></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span>